<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Vietnamese PDF Generation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <h1>Test Vietnamese Font Rendering in PDF</h1>
    
    <div>
        <h2>Test Vietnamese Text:</h2>
        <p id="testText">
            Xin chào! Tôi là sinh viên Việt Nam.<br>
            Các ký tự đặc biệt: áàảãạăắằẳẵặâấầẩẫậéèẻẽẹêếềểễệ<br>
            íìỉĩịóòỏõọôốồổỗộơớờởỡợúùủũụưứừửữự<br>
            ýỳỷỹỵđĐ<br>
            Họ và tên: Nguyễn Văn Minh<br>
            Địa chỉ: 123 Đường Lê Lợi, Quận 1, TP.HCM<br>
            Chức vụ: Giáo viên Tiếng Việt<br>
            Ghi chú: Đây là bài kiểm tra font tiếng Việt
        </p>
    </div>

    <div style="margin: 20px 0;">
        <button onclick="testBasicPDF()">Test Basic PDF (No Custom Font)</button>
        <button onclick="testWithArialFont()">Test with Arial Font</button>
        <button onclick="testWithTimesFont()">Test with Times Font</button>
        <button onclick="testFontManager()">Test FontManager</button>
    </div>

    <div id="results" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;">
        <h3>Test Results:</h3>
        <div id="output"></div>
    </div>

    <script type="module">
        // Import FontManager if available
        let FontManager = null;
        try {
            const fontModule = await import('./src/utils/FontManager.js');
            FontManager = fontModule.default;
            log('FontManager loaded successfully');
        } catch (error) {
            log('FontManager not available: ' + error.message);
        }

        function log(message) {
            const output = document.getElementById('output');
            output.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
            console.log(message);
        }

        window.testBasicPDF = function() {
            log('Testing basic PDF without custom font...');
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const testText = document.getElementById('testText').innerText;
                
                doc.setFontSize(12);
                doc.text('Basic PDF Test - No Custom Font', 20, 20);
                
                // Split text into lines and add to PDF
                const lines = testText.split('\n');
                let y = 40;
                lines.forEach(line => {
                    if (line.trim()) {
                        doc.text(line, 20, y);
                        y += 10;
                    }
                });
                
                // Open PDF in new tab
                window.open(doc.output('bloburl'), '_blank');
                log('Basic PDF generated successfully');
                
            } catch (error) {
                log('Error generating basic PDF: ' + error.message);
                console.error(error);
            }
        };

        window.testWithArialFont = function() {
            log('Testing PDF with Arial font...');
            try {
                // Try to load Arial font data
                import('./src/fonts/Arial-Regular.js').then(arialModule => {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    // Add Arial font to jsPDF
                    doc.addFileToVFS('Arial-Regular.ttf', arialModule.ArialRegularFont);
                    doc.addFont('Arial-Regular.ttf', 'Arial', 'normal');
                    
                    // Set font and generate PDF
                    doc.setFont('Arial');
                    doc.setFontSize(12);
                    
                    const testText = document.getElementById('testText').innerText;
                    
                    doc.text('Arial Font Test', 20, 20);
                    
                    const lines = testText.split('\n');
                    let y = 40;
                    lines.forEach(line => {
                        if (line.trim()) {
                            doc.text(line, 20, y);
                            y += 10;
                        }
                    });
                    
                    window.open(doc.output('bloburl'), '_blank');
                    log('Arial font PDF generated successfully');
                    
                }).catch(error => {
                    log('Error loading Arial font: ' + error.message);
                });
                
            } catch (error) {
                log('Error generating Arial PDF: ' + error.message);
                console.error(error);
            }
        };

        window.testWithTimesFont = function() {
            log('Testing PDF with Times font...');
            try {
                // Try to load Times font data
                import('./src/fonts/Times-Regular.js').then(timesModule => {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    // Add Times font to jsPDF
                    doc.addFileToVFS('Times-Regular.ttf', timesModule.TimesRegularFont);
                    doc.addFont('Times-Regular.ttf', 'Times', 'normal');
                    
                    // Set font and generate PDF
                    doc.setFont('Times');
                    doc.setFontSize(12);
                    
                    const testText = document.getElementById('testText').innerText;
                    
                    doc.text('Times Font Test', 20, 20);
                    
                    const lines = testText.split('\n');
                    let y = 40;
                    lines.forEach(line => {
                        if (line.trim()) {
                            doc.text(line, 20, y);
                            y += 10;
                        }
                    });
                    
                    window.open(doc.output('bloburl'), '_blank');
                    log('Times font PDF generated successfully');
                    
                }).catch(error => {
                    log('Error loading Times font: ' + error.message);
                });
                
            } catch (error) {
                log('Error generating Times PDF: ' + error.message);
                console.error(error);
            }
        };

        window.testFontManager = function() {
            if (!FontManager) {
                log('FontManager not available - cannot test');
                return;
            }
            
            log('Testing PDF with FontManager...');
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Use FontManager to set Vietnamese font
                FontManager.setVietnameseFont(doc, 'ARIAL', 12);
                
                const testText = document.getElementById('testText').innerText;
                
                doc.text('FontManager Test - Arial Font', 20, 20);
                
                const lines = testText.split('\n');
                let y = 40;
                lines.forEach(line => {
                    if (line.trim()) {
                        doc.text(line, 20, y);
                        y += 10;
                    }
                });
                
                window.open(doc.output('bloburl'), '_blank');
                log('FontManager PDF generated successfully');
                
            } catch (error) {
                log('Error generating FontManager PDF: ' + error.message);
                console.error(error);
            }
        };

        // Test font loading on page load
        log('Page loaded - testing font availability...');
        
        // Check if font files exist
        fetch('./src/fonts/Arial-Regular.js')
            .then(response => {
                if (response.ok) {
                    log('Arial-Regular.js file is accessible');
                } else {
                    log('Arial-Regular.js file not found or not accessible');
                }
            })
            .catch(error => {
                log('Error checking Arial font file: ' + error.message);
            });
            
        fetch('./src/fonts/Times-Regular.js')
            .then(response => {
                if (response.ok) {
                    log('Times-Regular.js file is accessible');
                } else {
                    log('Times-Regular.js file not found or not accessible');
                }
            })
            .catch(error => {
                log('Error checking Times font file: ' + error.message);
            });
    </script>
</body>
</html>
