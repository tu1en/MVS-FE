<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test PDF Text Wrapping</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1890ff;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            display: block;
            width: 100%;
        }
        .test-button:hover {
            background: #40a9ff;
        }
        .info {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
        }
        .success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }
        .error {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Test PDF Text Wrapping Fix</h1>
        
        <div class="info">
            <strong>üìã M·ª•c ƒë√≠ch:</strong> Test xem text wrapping trong PDF c√≥ ho·∫°t ƒë·ªông ƒë√∫ng kh√¥ng.<br>
            <strong>üéØ K·ª≥ v·ªçng:</strong> Text d√†i s·∫Ω ƒë∆∞·ª£c xu·ªëng d√≤ng thay v√¨ b·ªã c·∫Øt.
        </div>

        <button class="test-button" onclick="testTextWrapping()">
            üß™ Test Text Wrapping trong PDF
        </button>

        <button class="test-button" onclick="testContractPDF()">
            üìÑ Test Contract PDF (Gi·ªëng nh∆∞ trong app)
        </button>

        <div id="result" style="margin-top: 20px;"></div>
    </div>

    <script type="module">
        // Import FontManager (simulated)
        const FontManager = {
            setVietnameseFont: function(doc, fontType, fontSize) {
                console.log(`Setting Vietnamese font: ${fontType}, size: ${fontSize}`);
                doc.setFont('helvetica'); // Fallback for test
                doc.setFontSize(fontSize);
                return fontType;
            }
        };

        window.testTextWrapping = function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Set Vietnamese font
            FontManager.setVietnameseFont(doc, 'ARIAL', 12);
            
            let yPosition = 20;
            
            // Test long text wrapping
            doc.text('üß™ TEST TEXT WRAPPING:', 20, yPosition);
            yPosition += 20;
            
            // Test 1: Long text WITHOUT wrapping (old way)
            doc.text('‚ùå KH√îNG WRAP (C≈©):', 20, yPosition);
            yPosition += 10;
            doc.text('- B√™n B ph·∫£i tu√¢n th·ªß ƒë·∫ßy ƒë·ªß, ƒë√∫ng ch∆∞∆°ng tr√¨nh d·∫°y, ƒë·∫£m b·∫£o ch·∫•t l∆∞·ª£ng h·ªçc t·∫≠p c·ªßa h·ªçc sinh.', 30, yPosition);
            yPosition += 20;
            
            // Test 2: Long text WITH wrapping (new way)
            doc.text('‚úÖ C√ì WRAP (M·ªõi):', 20, yPosition);
            yPosition += 10;
            const wrappedText = doc.splitTextToSize('- B√™n B ph·∫£i tu√¢n th·ªß ƒë·∫ßy ƒë·ªß, ƒë√∫ng ch∆∞∆°ng tr√¨nh d·∫°y, ƒë·∫£m b·∫£o ch·∫•t l∆∞·ª£ng h·ªçc t·∫≠p c·ªßa h·ªçc sinh.', 150);
            doc.text(wrappedText, 30, yPosition);
            yPosition += wrappedText.length * 7;
            
            yPosition += 20;
            
            // Test 3: Multiple long texts
            doc.text('üìù NHI·ªÄU TEXT D√ÄI:', 20, yPosition);
            yPosition += 10;
            
            const texts = [
                '- B√™n A c√≥ quy·ªÅn y√™u c·∫ßu gi√°o vi√™n th·ª±c hi·ªán ƒë√∫ng n·ªôi dung gi·∫£ng d·∫°y theo h·ª£p ƒë·ªìng v√† c√≥ quy·ªÅn ki·ªÉm tra, ƒë√°nh gi√° ch·∫•t l∆∞·ª£ng gi·∫£ng d·∫°y.',
                '- B√™n B c√≥ quy·ªÅn ƒë∆∞·ª£c y√™u c·∫ßu h·ªó tr·ª£ t√†i li·ªáu, trang thi·∫øt b·ªã d·∫°y h·ªçc t·ª´ b√™n A, nh∆∞ng ph·∫£i ƒë·∫£m b·∫£o vi·ªác s·ª≠ d·ª•ng nh·ªØng t√†i li·ªáu n√†y ch·ªâ ph·ª•c v·ª• cho m·ª•c ƒë√≠ch gi·∫£ng d·∫°y ·ªü tr√™n l·ªõp.',
                '- N·∫øu B√™n B vi ph·∫°m n·ªôi quy ho·∫∑c t·ª± √Ω ngh·ªâ d·∫°y m√† kh√¥ng c√≥ l√Ω do ch√≠nh ƒë√°ng, B√™n A c√≥ quy·ªÅn ch·∫•m d·ª©t h·ª£p ƒë·ªìng ngay l·∫≠p t·ª©c v√† kh√¥ng thanh to√°n l∆∞∆°ng cho c√°c bu·ªïi d·∫°y ch∆∞a ho√†n th√†nh.'
            ];
            
            texts.forEach(text => {
                const wrapped = doc.splitTextToSize(text, 150);
                doc.text(wrapped, 30, yPosition);
                yPosition += wrapped.length * 7 + 5;
            });
            
            // Open PDF
            window.open(doc.output('bloburl'), '_blank');
            
            document.getElementById('result').innerHTML = `
                <div class="info success">
                    ‚úÖ <strong>Test ho√†n th√†nh!</strong><br>
                    PDF ƒë√£ ƒë∆∞·ª£c t·∫°o v·ªõi text wrapping. Ki·ªÉm tra xem text c√≥ b·ªã c·∫Øt kh√¥ng.
                </div>
            `;
        };

        window.testContractPDF = function() {
            // Simulate contract data
            const mockContract = {
                fullName: 'Nguy·ªÖn VƒÉn A',
                birthDate: '1990-01-01',
                citizenId: '123456789',
                address: '123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM',
                qualification: 'C·ª≠ nh√¢n S∆∞ ph·∫°m',
                phoneNumber: '0123456789',
                email: 'test@example.com',
                subject: 'To√°n h·ªçc',
                classLevel: 'L·ªõp 10',
                startDate: '2025-01-01',
                endDate: '2025-12-31',
                salary: 15000000
            };
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Set Vietnamese font
            FontManager.setVietnameseFont(doc, 'ARIAL', 14);
            
            let yPosition = 20;
            
            // Header
            doc.text('H·ª¢P ƒê·ªíNG LAO ƒê·ªòNG', 70, yPosition);
            yPosition += 20;
            
            // Contract content with wrapping
            const longTexts = [
                `H·ªç v√† t√™n: ${mockContract.fullName}`,
                `ƒê·ªãa ch·ªâ: ${mockContract.address}`,
                `Tr√¨nh ƒë·ªô chuy√™n m√¥n: ${mockContract.qualification}`,
                '- B√™n B ph·∫£i tu√¢n th·ªß ƒë·∫ßy ƒë·ªß, ƒë√∫ng ch∆∞∆°ng tr√¨nh d·∫°y, ƒë·∫£m b·∫£o ch·∫•t l∆∞·ª£ng h·ªçc t·∫≠p c·ªßa h·ªçc sinh.',
                '- B√™n A c√≥ quy·ªÅn y√™u c·∫ßu gi√°o vi√™n th·ª±c hi·ªán ƒë√∫ng n·ªôi dung gi·∫£ng d·∫°y theo h·ª£p ƒë·ªìng v√† c√≥ quy·ªÅn ki·ªÉm tra, ƒë√°nh gi√° ch·∫•t l∆∞·ª£ng gi·∫£ng d·∫°y.',
                '- B√™n B c√≥ quy·ªÅn ƒë∆∞·ª£c y√™u c·∫ßu h·ªó tr·ª£ t√†i li·ªáu, trang thi·∫øt b·ªã d·∫°y h·ªçc t·ª´ b√™n A, nh∆∞ng ph·∫£i ƒë·∫£m b·∫£o vi·ªác s·ª≠ d·ª•ng nh·ªØng t√†i li·ªáu n√†y ch·ªâ ph·ª•c v·ª• cho m·ª•c ƒë√≠ch gi·∫£ng d·∫°y ·ªü tr√™n l·ªõp.'
            ];
            
            longTexts.forEach(text => {
                const wrapped = doc.splitTextToSize(text, 150);
                doc.text(wrapped, 20, yPosition);
                yPosition += wrapped.length * 7 + 5;
            });
            
            // Open PDF
            window.open(doc.output('bloburl'), '_blank');
            
            document.getElementById('result').innerHTML = `
                <div class="info success">
                    ‚úÖ <strong>Contract PDF Test ho√†n th√†nh!</strong><br>
                    Ki·ªÉm tra PDF xem text c√≥ ƒë∆∞·ª£c wrap ƒë·∫ßy ƒë·ªß kh√¥ng.
                </div>
            `;
        };
    </script>
</body>
</html>
